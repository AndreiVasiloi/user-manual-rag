<div class="user-manual-assistant-container">
    <mat-card appearance="outlined">
        <mat-card-header class="user-manual-assistant-header">
            <div mat-card-avatar class="material-symbols-rounded text-primary user-manual-assistant-header-icon">
                robot_2
            </div>
            <mat-card-title>User Manual Assistant</mat-card-title>
            <mat-card-subtitle>Ask anything about your uploaded manual</mat-card-subtitle>
        </mat-card-header>
        <mat-divider></mat-divider>
        <mat-card-content>
            <!-- Upload -->
            <section class="user-manual-assistant-upload-container">
                <h3>Upload PDF</h3>
                <div class="user-manual-assistant-upload-field-container">
                    <div class="user-manual-assistant-upload-field">
                        <input type="file" accept="application/pdf" (change)="onFileSelected($event)"/>
                        <button mat-stroked-button
                                matButton="filled"
                                color="primary"
                                (click)="onUpload()"
                                [disabled]="!selectedFile">
                            <mat-icon>upload</mat-icon>
                            Upload
                        </button>
                    </div>
                    <p class="text-green">{{ uploadStatus() }}</p>
                </div>
            </section>
        </mat-card-content>
        <div class="user-manual-assistant-upload-or-search-divider-container">
            <mat-divider class="user-manual-assistant-upload-or-search-divider"></mat-divider>
            <span class="user-manual-assistant-upload-or-search-divider-text">or</span>
        </div>
        <mat-card-content>
            <section class="user-manual-assistant-search-container">
                <h3>Search for a manual</h3>
                <div class="user-manual-assistant-search-field-container">
                    <input type="text" placeholder="Search" [formControl]="searchForm">
                    @if (userManuals().length > 0) {
                        <select name="user manuals" [formControl]="selectedManualForm">
                            <option [value]="null">Choose your manual</option>
                            @for (userManual of userManuals(); track $index) {
                                <option [ngValue]="userManual">{{ userManual.title }}</option>
                            }
                        </select>
                    }
                    <div class="user-manual-assistant-search-actions-container">
                        <div class="action-button-container">
                            <button mat-flat-button
                                    matButton="filled"
                                    color="primary"
                                    class="action-button"
                                    (click)="onScrapeManual()"
                                    [disabled]="scrapeSpinner() || !selectedManualForm.value">
                                <mat-icon>search</mat-icon>
                                Scrape
                            </button>
                            @if (scrapeSpinner()) {
                                <mat-progress-spinner class="action-button-spinner"
                                                      mode="indeterminate"
                                                      diameter="28">
                                </mat-progress-spinner>
                            }
                        </div>
                        <div class="action-button-container">
                            <button mat-flat-button
                                    matButton="filled"
                                    color="primary"
                                    class="action-button"
                                    (click)="onSearchManual()"
                                    [disabled]="searchSpinner() || !searchForm.value?.trim()">
                                <mat-icon>search</mat-icon>
                                Search
                            </button>
                            @if (searchSpinner()) {
                                <mat-progress-spinner class="action-button-spinner"
                                                      mode="indeterminate"
                                                      diameter="28">
                                </mat-progress-spinner>
                            }
                        </div>
                    </div>
                </div>
            </section>
        </mat-card-content>
        <mat-divider></mat-divider>
        <mat-card-content>
            <!-- Ask -->
            <section class="user-manual-assistant-ask-container">
                <h3>Ask a question</h3>
                <textarea [formControl]="questionForm"
                          placeholder="Example: How do I clean the coffee filter?"
                          rows="5">
                </textarea>
                <div class="user-manual-assistant-ask-actions-container">
                    <button mat-flat-button
                            matButton="filled"
                            color="primary"
                            (click)="onAsk()"
                            [disabled]="askSpinner() || !questionForm.value?.trim()">
                        <mat-icon>send</mat-icon>
                        Ask
                    </button>
                    @if (askSpinner()) {
                        <mat-progress-spinner
                                mode="indeterminate"
                                diameter="28">
                        </mat-progress-spinner>
                    }
                </div>
            </section>
        </mat-card-content>
        @if (answer()) {
            <mat-divider></mat-divider>
            <mat-card-content>
                <section class="user-manual-assistant-answer-container">
                    <h3>Answer</h3>
                    <mat-card appearance="outlined">
                        <mat-card-content>
                            {{ answer() }}
                        </mat-card-content>
                    </mat-card>
                </section>
            </mat-card-content>
        }
    </mat-card>
</div>


